const express = require('express');
const router = express.Router();

const imageController = require('../controllers/imageController');
const animationController = require('../controllers/animationController');
const authRoutes = require('./auth');
const tokenRoutes = require('./token');
const paymentRoutes = require('./payment');
const { authenticateToken } = require('../middleware/auth');
const { requireTokens } = require('../middleware/tokenConsume');

router.get("/", (req, res) => {
    res.json({
        message: "Hello World"
    })
})

// 认证路由
router.use('/auth', authRoutes);

// Token路由
router.use('/token', tokenRoutes);

// 支付路由
router.use('/payment', paymentRoutes);

// 图像生成 - 需要登录和token消耗
router.post('/generate-image', 
    authenticateToken, 
    requireTokens('IMAGE_GENERATION'), 
    imageController.generateImage
);

// 动画生成 - 需要登录和token消耗
router.post('/generate-animation', 
    authenticateToken, 
    requireTokens('VIDEO_GENERATION'), 
    animationController.generateAnimation
);

module.exports = router;